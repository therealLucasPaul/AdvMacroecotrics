---
title: "Macrotrics Assignment 1"
author: "Unterweger L., Pirich G., Tijani S."
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
library(stats)
library(urca)
library(forecast)
```

## Excercise 1
### Loading and Cleaning Data
```{r}
fredmd <- read.csv("FRED_MD_data.csv")[-1,]
head(fredmd)
```

\textit{Create a function that takes a vector containing observations of a time series as input and returns a dataframe with the following transformed series in its columns as output:
– the original time series in its raw form.
– the log-transformed time series.
– month-on-month growth rates in percent.
– year-on-year growth rates in percent.
– the first lag of the year-on-year growth rates of the time series. !!!!Was ist das???}

```{r}
test <- c(1,4,5,6,5,4)
input_function <- function(input_vector){
  output_df <- data.frame(
    orig = input_vector,
    log_ts = log(input_vector),
    mom_growth = ((input_vector-lag(input_vector))/input_vector)*100,
    yoy_growth = ((input_vector-lag(input_vector,n=12))/input_vector)*100,
    yoy_growth_lag = ((lag(input_vector,n=1)-lag(input_vector,n=13))/lag(input_vector,n=1))*100
  )
  return(output_df)
}
input_function(fredmd$RETAILx)
```

\textit{Use the created function to create a dataframe with the various transformation for US industrial production (mnemonic INDPRO), plot the logged time series and the yearly changes produced by the function. Briefly describe the properties of the time series.}
```{r}
industrial_prod <- cbind(date=as.Date(fredmd$sasdate, "%m/%d/%Y"),input_function(fredmd$INDPRO))
ggplot(industrial_prod, aes(x=date,y=log_ts))+
  geom_line( color="#69b3a2", alpha=0.9, linetype=1) +
  ggtitle("Time Series of logged Industrial Production (INDPRO)")+
  ylab("logged industrial production")
ggplot(industrial_prod, aes(x=date,y=yoy_growth))+
  geom_line( color="#69b3a2", alpha=0.9, linetype=1) +
  ggtitle("Time Series of yoy change of Industrial Production (INDPRO)")+
  ylab("yoy change of industrial production")
```

DESCRIBE THE FEATURES

\textit{Using suitable functions from the stats and urca package, assess the properties of both logged industrial production and its yearly growth rate. Plot the autocorrelation function and perform Dickey-Fuller tests to test for a unit root (note the different specifications, i.e. including a drift or a trend), interpret the results.}
```{r}
# Create time series object
log_INDPRO <- ts(industrial_prod$log_ts, frequency = 12, start = c(1959,1,1))
yoy_INDPRO <- ts(industrial_prod$yoy_growth, frequency = 12, start = c(1960,1,1))

# Plot the time series
plot(log_INDPRO)
plot(yoy_INDPRO)

# Create the acf plots
Acf(log_INDPRO)
Acf(yoy_INDPRO)

# Dickey Fuller Test
tseries::adf.test(na.omit(yoy_INDPRO))
tseries::adf.test(na.omit(log_INDPRO))
```

\textit{Estimate a suitable AR model (e.g. using the ar.ols() function) for the stationary time series (as determined in the previous point).1 How is the lag order determined by default? Use the estimated model to produce forecasts for the next year and plot them. Interpret their behaviour (i.e. are they converging towards a certain value? What could that be?). Use the produced forecasts to also forecast the change in the original time series.}
```{r}
mod1 <- ar.ols(na.omit(yoy_INDPRO))
summary(mod1)
```

## Excercise 2

\textit{Read Kilian & Park (2009), who discuss the effects of oil price shocks on the US stock market, focus on Sections 2 and 3.1-3.3. Load the provided data by Kilian & Park (2009), which contains a measure of change in oil production, a measure of real economic activity, the real price of oil, and changes in real US dividend growth from 1973M1 to 2016M12.}

```{r}
library(vars)
data <- read.table("data_kilian_park_2009.txt")
#("Global Oil Production Change","Global Real Activity","Real Price of Oil","US Stock Returns")
colnames(data) <- c("GOPC","GRA","RPO","USSR")
data
```
\begin{itemize}
\item Using the the packages vars in R (or an equivalent one in another language), estimate the VAR described in
section 2.2 using the variables in the same order as specified by Kilian & Park (2009).
```{r}
mod1 <- VAR(data,p=24, type="none")
mod1
summary(mod1)
```

\item Using the estimated VAR, compute impulse response functions (take a look at the irf() function in vars, it
uses the same identification scheme as Kilian & Park (2009) propose (recursive ordering based on a Cholesky
decomposition of the vcov-matrix of the errors) by default. Replicate Figure 1 and the lower panel in figure 3
of Kilian & Park (2009). Interpret the results.
```{r}
ir.mod1 <- irf(mod1,impulse=c("GOPC","GRA","RPO"),respons = "RPO",n.ahead = 15)
par(mfrow=c(3,1))
plot(ir.mod1,ylim=c(-6,12))
```

\item Calculate forecast error variance decompositions for the included variables (take a look at the fevd() function
in vars). Replicate Table 2 of Kilian & Park (2009). Interpret the results.
```{r}

```

\item Note that the dataset provided misses US stock market returns (due to the licensing of the underlying time
series). Look for alternative data on the US stock market,4 create a variable similar to the one used by Kilian
& Park (2009). Re-estimate the model and replicate Figure 1 again as well as the top panel of Figure 3 and
Table 1.5 Interpret the results.
```{r}

```

\end{itemize}
